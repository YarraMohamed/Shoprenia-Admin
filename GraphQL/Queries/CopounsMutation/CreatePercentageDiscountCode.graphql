mutation CreatePercentageDiscountCode(
  $title: String!,
  $startsAt: DateTime!,
  $endsAt: DateTime!,
  $usageLimit: Int,
  $code: String!,
  $percentage: Float!,
  $appliesOncePerCustomer: Boolean!,
  $minSubtotal: Decimal
) {
  discountCodeBasicCreate(
    basicCodeDiscount: {
      title: $title,
      startsAt: $startsAt,
      endsAt: $endsAt,
      usageLimit: $usageLimit,
      customerSelection: { all: true },
      code: $code,
      customerGets: {
        value: { percentage: $percentage },
        items: { all: true }
      },
      appliesOncePerCustomer: $appliesOncePerCustomer,
      minimumRequirement: {
        subtotal: { greaterThanOrEqualToSubtotal: $minSubtotal }
      }
    }
  ) {
    userErrors {
      field
      message
    }
    codeDiscountNode {
      id
      codeDiscount {
        ... on DiscountCodeBasic {
          title
          status
          startsAt
          endsAt
          codes(first: 1) {
            nodes {
              code
            }
          }
        }
      }
    }
  }
}
